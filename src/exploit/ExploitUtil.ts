import {Promise} from "es6-promise";


class ExploitUtil {

    private static sendNotification(msg:string) {
        console.log('sendNotification', msg);
        top.postMessage(msg, '*');
    }

    public static confirmShouldRun():Promise<any> {
        return new Promise((resolve) => {
            let onMessage = (evt) => {
                console.log('confirmShouldRun#onMessage', evt.data);
                if (evt.data === '#OK#') {
                    window.removeEventListener('message', onMessage, false);
                    resolve();
                }
            };
            window.addEventListener('message', onMessage, false);
            ExploitUtil.sendNotification('#LOADED#');
        });
    }

    public static notifyError(error:any):Promise<any> {
        ExploitUtil.sendNotification('#ERROR#' + error);
        return Promise.resolve();

    }

    public static notifyDone():Promise<any> {
        ExploitUtil.sendNotification('#DONE#');
        return Promise.resolve();
    }
}

export default ExploitUtil;